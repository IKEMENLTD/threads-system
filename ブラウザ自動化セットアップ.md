# 🚀 Threadsブラウザ自動化システム セットアップガイド

## 📋 概要

Threads APIの代替として、ブラウザ自動化とOCR技術を使用した投稿システムです。

### 主な特徴
- ✅ Seleniumによるブラウザ完全制御
- ✅ OCRによる画面状態の自動認識
- ✅ 人間的な操作パターンの模倣
- ✅ WebSocketによるリアルタイム制御
- ✅ HTMLダッシュボードからの操作

## 🛠️ セットアップ手順

### 1. 必要なソフトウェアのインストール

#### Windows
```bash
# Python 3.9以上をインストール
# https://www.python.org/downloads/

# Chrome最新版をインストール
# https://www.google.com/chrome/

# Tesseract OCRをインストール
# https://github.com/UB-Mannheim/tesseract/wiki
# インストール後、環境変数PATHに追加
```

#### Mac
```bash
# Homebrewをインストール
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Python 3.9以上
brew install python@3.9

# Tesseract OCR
brew install tesseract
brew install tesseract-lang  # 日本語対応

# Chrome
brew install --cask google-chrome
```

#### Linux (Ubuntu/Debian)
```bash
# システム更新
sudo apt update && sudo apt upgrade -y

# Python 3.9
sudo apt install python3.9 python3-pip -y

# Tesseract OCR
sudo apt install tesseract-ocr tesseract-ocr-jpn -y

# Chrome
wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
sudo apt update
sudo apt install google-chrome-stable -y

# 仮想ディスプレイ（ヘッドレス実行用）
sudo apt install xvfb -y
```

### 2. Pythonパッケージのインストール

```bash
# プロジェクトディレクトリに移動
cd /mnt/c/Users/RN-事務所/Downloads/Threads自動ツールVer003

# 仮想環境作成（推奨）
python -m venv venv

# 仮想環境有効化
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

# パッケージインストール
pip install -r python/requirements_browser.txt
```

### 3. ChromeDriverの自動ダウンロード確認

```python
# テスト実行
python -c "from selenium import webdriver; driver = webdriver.Chrome(); driver.quit(); print('✅ ChromeDriver正常動作')"
```

### 4. Tesseract OCRの動作確認

```bash
# バージョン確認
tesseract --version

# 日本語サポート確認
tesseract --list-langs | grep jpn
```

## 🎮 使用方法

### 1. WebSocketサーバー起動

```bash
# ターミナル1
cd python
python websocket_server.py

# 出力例:
# WebSocketサーバー起動: http://0.0.0.0:8888
```

### 2. HTMLインターフェースを開く

ブラウザで以下を開く:
```
http://localhost:8888
```

または直接HTMLファイルを開く:
```
test_automation.html
```

### 3. ログインテスト

1. HTMLインターフェースで「ログインテスト」セクションを確認
2. Threadsのユーザー名とパスワードを入力
3. 「ログインテスト」ボタンをクリック
4. ブラウザが自動的に起動し、ログイン処理が実行される

### 4. 投稿テスト

1. ログイン成功後、「投稿テスト」セクションへ
2. 投稿内容を入力
3. 必要に応じて画像を選択
4. 「投稿テスト」ボタンをクリック

### 5. 自動化実行

1. 「自動化制御」セクションで「自動化開始」をクリック
2. 予約投稿が自動的に処理される
3. 停止する場合は「停止」ボタンをクリック

## 🔧 高度な設定

### プロキシ使用

```python
# python/browser_automation/threads_bot.py
bot = ThreadsBot(
    headless=False,
    use_proxy="http://proxy.example.com:8080"
)
```

### ヘッドレスモード（画面非表示）

```python
bot = ThreadsBot(headless=True)
```

### カスタムセレクタ設定

```python
# セレクタが変更された場合
bot.selectors['compose']['new_post_button'] = '[data-testid="new-post"]'
```

## 📊 モニタリング

### ログファイル確認
```bash
# ログディレクトリ
tail -f logs/automation.log
```

### スクリーンショット確認
```bash
# スクリーンショット保存先
ls screenshots/
```

## ⚠️ トラブルシューティング

### 問題: ChromeDriverバージョン不一致
```bash
# 解決策: undetected-chromedriverが自動で対応
pip install --upgrade undetected-chromedriver
```

### 問題: OCRが日本語を認識しない
```bash
# 解決策: 日本語データインストール
# Windows: Tesseractインストーラーで日本語選択
# Mac/Linux:
sudo apt install tesseract-ocr-jpn
```

### 問題: WebSocket接続エラー
```bash
# ファイアウォール設定確認
# ポート8888が開いているか確認
netstat -an | grep 8888
```

### 問題: Bot検出される
```python
# 対策: 人間的動作を強化
bot.random_wait(3, 7)  # 待機時間を長く
bot.random_mouse_movement()  # マウス動作追加
```

## 🔒 セキュリティ注意事項

1. **パスワード管理**
   - 環境変数に保存
   - ハードコードしない
   
2. **アクセス制限**
   - WebSocketサーバーをローカルのみで実行
   - 本番環境では認証を追加

3. **レート制限**
   - 過度な自動化を避ける
   - 人間的な操作間隔を維持

## 📈 パフォーマンス最適化

### メモリ使用量削減
```python
# 定期的にブラウザをリスタート
if post_count % 50 == 0:
    bot.quit()
    bot = ThreadsBot()
    bot.setup_driver()
```

### 並列処理（複数アカウント）
```python
# 複数インスタンス実行
bots = []
for account in accounts:
    bot = ThreadsBot()
    bot.setup_driver()
    bot.login(account['username'], account['password'])
    bots.append(bot)
```

## 🚦 動作確認チェックリスト

- [ ] Python 3.9以上インストール済み
- [ ] Google Chrome最新版インストール済み
- [ ] Tesseract OCRインストール済み
- [ ] requirements_browser.txtインストール済み
- [ ] WebSocketサーバー起動確認
- [ ] HTMLインターフェース表示確認
- [ ] ログイン機能動作確認
- [ ] 投稿機能動作確認
- [ ] スクリーンショット撮影確認
- [ ] OCR認識動作確認

## 📞 サポート

問題が発生した場合:
1. ログファイルを確認
2. スクリーンショットを確認
3. エラーメッセージをコピー
4. 設定を再確認

## 🎯 次のステップ

1. **本番環境設定**
   - SSL証明書設定
   - データベース接続
   - バックアップ設定

2. **機能拡張**
   - 複数アカウント管理
   - スケジュール投稿
   - 分析機能追加

3. **最適化**
   - Docker化
   - CI/CD設定
   - 監視システム構築