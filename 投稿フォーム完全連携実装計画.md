# æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ å®Œå…¨é€£æºå®Ÿè£…è¨ˆç”»

## ğŸ“‹ ç¾çŠ¶åˆ†æ

### 1. ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œè¡¨

| ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  | HTML ID | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ— | ãƒ‡ãƒ¼ã‚¿å‹ | ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ |
|-------------|---------|---------------|----------|-------------|
| ã‚¿ã‚¤ãƒˆãƒ« | `postTitle` | `posts.title` | VARCHAR | âŒ **æœªå¯¾å¿œ** |
| å†…å®¹ | `postContent` | `posts.content` | TEXT | âœ… å¯¾å¿œæ¸ˆã¿ |
| ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚° | `postHashtags` | `post_hashtags` | é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ« | âš ï¸ **éƒ¨åˆ†å¯¾å¿œ** |
| æŠ•ç¨¿æ—¥æ™‚ | `postSchedule` | `posts.scheduled_at` | TIMESTAMP | âœ… å¯¾å¿œæ¸ˆã¿ |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `postStatus` | `posts.status` | ENUM | âœ… å¯¾å¿œæ¸ˆã¿ |

### 2. ç¾åœ¨ã®å•é¡Œç‚¹

#### ğŸ”´ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®ä¸æ•´åˆ
- ãƒ•ã‚©ãƒ¼ãƒ ã«ã¯`title`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹ãŒã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã«`title`åˆ—ãŒãªã„
- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‡¦ç†ãŒè¤‡é›‘ï¼ˆpost_hashtagsé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

#### ğŸ”´ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã®ä¸æ•´åˆ
- `postTitle`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®nameå±æ€§ãŒæœªè¨­å®š
- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†ã§titleã‚’é€ä¿¡ã™ã‚‹ãŒã€APIãŒå—ã‘å–ã‚Œãªã„

#### ğŸ”´ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä¸æ•´åˆ
- æŠ•ç¨¿ä½œæˆAPI ã§titleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ãŒã€DBã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ãªã„

## ğŸ¯ å®Ÿè£…ã™ã¹ãé …ç›®

### A. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒä¿®æ­£ï¼ˆæœ€å„ªå…ˆï¼‰

```sql
-- 1. postsãƒ†ãƒ¼ãƒ–ãƒ«ã«titleåˆ—ã‚’è¿½åŠ 
ALTER TABLE posts 
ADD COLUMN title VARCHAR(200);

-- 2. titleã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
CREATE INDEX idx_posts_title ON posts(title);

-- 3. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®titleè¨­å®šï¼ˆæŠ•ç¨¿å†…å®¹ã®æœ€åˆã®30æ–‡å­—ï¼‰
UPDATE posts 
SET title = LEFT(content, 30) || CASE WHEN LENGTH(content) > 30 THEN '...' ELSE '' END
WHERE title IS NULL;
```

### B. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£

#### 1. HTMLä¿®æ­£ (`posts.html`)
```html
<!-- nameå±æ€§ã‚’è¿½åŠ  -->
<input type="text" id="postTitle" name="postTitle" class="form-input" placeholder="æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›">
```

#### 2. JavaScriptä¿®æ­£ (`js/pages/posts.js`)

**ä¿®æ­£ç®‡æ‰€1: ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†**
```javascript
savePost: async function() {
    const formData = new FormData(this.postForm);
    
    const postData = {
        title: formData.get('postTitle') || '', // âœ… è¿½åŠ 
        content: formData.get('postContent'),
        hashtags: formData.get('postHashtags'),
        status: formData.get('postStatus'),
        scheduledAt: formData.get('postSchedule')
    };
    
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
    if (!postData.title.trim()) {
        this.showError('postTitle', 'ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™');
        return;
    }
    
    // APIå‘¼ã³å‡ºã—
    const response = await this.submitToAPI(postData);
}
```

**ä¿®æ­£ç®‡æ‰€2: æŠ•ç¨¿è¡¨ç¤ºå‡¦ç†**
```javascript
renderPost: function(post) {
    return `
        <div class="post-card" data-post-id="${post.id}">
            <div class="post-header">
                <h3 class="post-title">${this.escapeHtml(post.title)}</h3> <!-- âœ… è¿½åŠ  -->
                <span class="post-status status-${post.status}">${this.getStatusText(post.status)}</span>
            </div>
            <div class="post-content">${this.escapeHtml(post.content.substring(0, 100))}...</div>
            <!-- ä»¥ä¸‹æ—¢å­˜ã‚³ãƒ¼ãƒ‰ -->
        </div>
    `;
}
```

#### 3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–
```javascript
validatePostForm: function() {
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('postContent').value.trim();
    
    // ã‚¿ã‚¤ãƒˆãƒ«æ¤œè¨¼
    if (!title) {
        this.showError('postTitle', 'ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™');
        return false;
    }
    if (title.length > 200) {
        this.showError('postTitle', 'ã‚¿ã‚¤ãƒˆãƒ«ã¯200æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
        return false;
    }
    
    // å†…å®¹æ¤œè¨¼
    if (!content) {
        this.showError('postContent', 'æŠ•ç¨¿å†…å®¹ã¯å¿…é ˆã§ã™');
        return false;
    }
    
    return true;
}
```

### C. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ APIä¿®æ­£

#### 1. æŠ•ç¨¿ä½œæˆAPI (`backend/routes/posts.js`)

**ä¿®æ­£ç®‡æ‰€1: ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
```javascript
// POST /api/posts
router.post('/', authenticateToken, async (req, res) => {
    try {
        const { title, content, hashtags, status, scheduledAt } = req.body;
        
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if (!title?.trim()) {
            return res.status(400).json({ 
                success: false, 
                error: 'ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™' 
            });
        }
        
        if (!content?.trim()) {
            return res.status(400).json({ 
                success: false, 
                error: 'æŠ•ç¨¿å†…å®¹ã¯å¿…é ˆã§ã™' 
            });
        }
        
        // æŠ•ç¨¿ã‚’DBã«ä¿å­˜
        const { data: post, error } = await supabase
            .from('posts')
            .insert({
                user_id: req.user.id,
                title: title.trim(),           // âœ… è¿½åŠ 
                content: content.trim(),
                status: status || 'draft',
                scheduled_at: scheduledAt || null
            })
            .select()
            .single();
            
        if (error) {
            console.error('æŠ•ç¨¿ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            return res.status(500).json({ 
                success: false, 
                error: 'æŠ•ç¨¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ' 
            });
        }
        
        // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‡¦ç†
        if (hashtags && hashtags.length > 0) {
            await processHashtags(post.id, hashtags);
        }
        
        res.json({ success: true, post });
        
    } catch (error) {
        console.error('æŠ•ç¨¿ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
        res.status(500).json({ 
            success: false, 
            error: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' 
        });
    }
});
```

**ä¿®æ­£ç®‡æ‰€2: ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‡¦ç†é–¢æ•°**
```javascript
async function processHashtags(postId, hashtags) {
    for (const tag of hashtags) {
        const cleanTag = tag.replace('#', '').trim();
        if (!cleanTag) continue;
        
        // ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’å–å¾—ã¾ãŸã¯ä½œæˆ
        let { data: hashtag } = await supabase
            .from('hashtags')
            .select('id')
            .eq('name', cleanTag)
            .single();
            
        if (!hashtag) {
            const { data: newHashtag } = await supabase
                .from('hashtags')
                .insert({ name: cleanTag })
                .select('id')
                .single();
            hashtag = newHashtag;
        }
        
        // é–¢é€£ã‚’ä½œæˆ
        await supabase
            .from('post_hashtags')
            .insert({
                post_id: postId,
                hashtag_id: hashtag.id
            });
    }
}
```

#### 2. æŠ•ç¨¿å–å¾—APIä¿®æ­£
```javascript
// GET /api/posts
router.get('/', authenticateToken, async (req, res) => {
    const { data: posts, error } = await supabase
        .from('posts')
        .select(`
            id, title, content, status, scheduled_at, created_at, updated_at,  // âœ… titleã‚’è¿½åŠ 
            hashtags:post_hashtags(hashtags(name))
        `)
        .eq('user_id', req.user.id)
        .order('created_at', { ascending: false });
        
    // ãƒ‡ãƒ¼ã‚¿æ•´å½¢
    const formattedPosts = posts.map(post => ({
        id: post.id,
        title: post.title || '',           // âœ… è¿½åŠ 
        content: post.content,
        status: post.status,
        scheduledAt: post.scheduled_at,
        createdAt: post.created_at,
        hashtags: post.hashtags?.map(h => h.hashtags.name) || []
    }));
    
    res.json({ success: true, posts: formattedPosts });
});
```

### D. CSSä¿®æ­£

#### 1. æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ã«ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤º (`css/pages/posts.css`)
```css
.post-card .post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.post-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
    flex: 1;
    margin-right: 1rem;
}

.post-content {
    color: var(--color-text-secondary);
    line-height: 1.5;
    margin-bottom: 1rem;
}
```

## ğŸš€ å®Ÿè£…é †åº

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æº–å‚™ï¼ˆ5åˆ†ï¼‰
1. Supabaseã§postsãƒ†ãƒ¼ãƒ–ãƒ«ã«titleåˆ—è¿½åŠ 
2. æ—¢å­˜æŠ•ç¨¿ã®titleè‡ªå‹•ç”Ÿæˆ

### ãƒ•ã‚§ãƒ¼ã‚º2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¿®æ­£ï¼ˆ15åˆ†ï¼‰
1. æŠ•ç¨¿ä½œæˆAPIã§titleå‡¦ç†è¿½åŠ 
2. æŠ•ç¨¿å–å¾—APIã§titleè¿”å´
3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–

### ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£ï¼ˆ20åˆ†ï¼‰
1. HTMLã«nameå±æ€§è¿½åŠ 
2. JavaScripté€ä¿¡å‡¦ç†ä¿®æ­£
3. æŠ•ç¨¿è¡¨ç¤ºå‡¦ç†ä¿®æ­£
4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

### ãƒ•ã‚§ãƒ¼ã‚º4: CSSãƒ»UXæ”¹å–„ï¼ˆ10åˆ†ï¼‰
1. ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 
2. ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºæ”¹å–„

## ğŸ“ ãƒ†ã‚¹ãƒˆé …ç›®

### æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ä»˜ãæŠ•ç¨¿ã®ä½œæˆ
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ãªã—æŠ•ç¨¿ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- [ ] ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ä»˜ãæŠ•ç¨¿
- [ ] äºˆç´„æŠ•ç¨¿ã®ä½œæˆ
- [ ] æŠ•ç¨¿ä¸€è¦§ã§ã®è¡¨ç¤ºç¢ºèª

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
- [ ] ç©ºã‚¿ã‚¤ãƒˆãƒ«ã§ã®é€ä¿¡ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
- [ ] 201æ–‡å­—ã‚¿ã‚¤ãƒˆãƒ«ã§ã®é€ä¿¡ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
- [ ] ç©ºå†…å®¹ã§ã®é€ä¿¡ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
- [ ] æ­£å¸¸ãƒ‡ãƒ¼ã‚¿ã§ã®é€ä¿¡ï¼ˆæˆåŠŸï¼‰

### è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
- [ ] æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ã§ã®ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤º
- [ ] é•·ã„ã‚¿ã‚¤ãƒˆãƒ«ã®çœç•¥è¡¨ç¤º
- [ ] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã®ç¢ºèª

## ğŸ”§ å®Œäº†å¾Œã®çŠ¶æ…‹

å®Ÿè£…å®Œäº†å¾Œã¯ä»¥ä¸‹ã®æµã‚Œã§å‹•ä½œã—ã¾ã™ï¼š

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› 
â†“
[ãƒ•ã‚©ãƒ¼ãƒ ] ã‚¿ã‚¤ãƒˆãƒ« + å†…å®¹ + ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚° + æ—¥æ™‚ + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
â†“
[JavaScript] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â†’ FormDataåé›†
â†“
[API] POST /api/posts â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ + ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‡¦ç†
â†“
[è¡¨ç¤º] æŠ•ç¨¿ä¸€è¦§ã«åæ˜ ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ä»˜ãã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰
```

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»APIãŒå®Œå…¨ã«é€£æºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã™ã¹ã¦ã®æƒ…å ±ãŒé©åˆ‡ã«ä¿å­˜ãƒ»è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚